<!DOCTYPE html>
<html lang="en">

<head>
<<<<<<< HEAD
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0" />
    <link href="https://fonts.googleapis.com/css?family=Fredericka+the+Great|Alegreya" rel="stylesheet">
    <title>Lazy Chef</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="assets/css/style.css">
    <script src="https://www.gstatic.com/firebasejs/4.8.0/firebase.js"></script>
</head>

<body>
    <div class="section no-pad-bot" id="index-banner">
        <div class="container">
            <br>
            <br>
            <h1 class="header center projectname">LazyChef</h1>
            <div class="row center">
                <h5 class="header col s12 light">Your Ingredients. Our Recipes. Made Easy. </h5>
            </div>
            <div class="row">
                <form class="col s12">
                    <div class="row">
                        <div class="input-field col s12" id="ingredients">
                            <textarea id="textarea1" class="materialize-textarea"></textarea>
                            <label id="label" for="textarea1"></label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="row center">
                <a class="btn-large waves-effect waves-light orange" id="getStarted">Get Started</a>
            </div>
        </div>
    </div>
    <div class="row" id="form-display"></div>
    <div class="row center" id="button-display"></div>
    <div class="row" id="card-display"></div>
    <div id="ingredient-table">
        <table id="table">
            <thead>
                <tr>
                    <th>Ingredients</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td></td>
                    <td></td>
                </tr>
            </tbody>
        </table>
    </div>
    <div id="map"></div>
    <script type="text/javascript">
    // VARIABLES==========================================================================  
    //initialize the page
    getStarted();
    var config = {
        apiKey: "AIzaSyD8Ov99hsKZO0NbPCd1fVBlX3EuWKLX0tI",
        authDomain: "project-one-f8be2.firebaseapp.com",
        databaseURL: "https://project-one-f8be2.firebaseio.com",
        projectId: "project-one-f8be2",
        storageBucket: "",
        messagingSenderId: "426004539514"
    };

    firebase.initializeApp(config);

    var database = firebase.database();
    // on page load form is hidden
    $("#textarea1").hide();
    $("#table").hide();

    //Array that we will push ingredients into on click Submit Button 
    var ingredients_array = ["carrots"];
    var ingredients = $("#ingredients").val().trim();

    //is pushing to array,but not when I change it to ingredients
    ingredients_array.push(ingredients);
    // console.log(ingredients_array);

    //Combines ingredients with a ',' so that it is properly placed in the query URL
    var combined_string = ingredients_array.join(',');

    var recipeId = [];

    // console.log(combined_string);

    var queryURL = "https://spoonacular-recipe-food-nutrition-v1.p.mashape.com/recipes/findByIngredients?fillIngredients=false&ingredients=" + combined_string + "limitLicense=false&number=5&ranking=1";

    // console.log(queryURL);

    // =============Click events===========================================================

    // wrapped the getStarted click event in a function; call this function to initalize page
    function getStarted() {
        $("#getStarted").on("click", function(event) {
            event.preventDefault();

            //hide getStarted button
            $("#getStarted").hide();

            //show form
            $("#textarea1").show();

            //dynamically create form and search button
            var form = $("<form>");
            form.addClass("col s12");
            var div = $("<div>");
            div.addClass("row");

            //id ingredients will be used to grab input
            var divtwo = $("<div>");
            divtwo.addClass("input-field col s12");
            divtwo.attr("id", "ingredients");
            var textarea = $("textarea");
            textarea.attr("id", "textarea1");
            textarea.addClass("materialize-textarea");
            var label = $("<label>");
            label.addClass("active");
            label.attr("for", "textarea1");
            label.attr("id", "label");
            label.text("Enter your ingredients");

            //append form to page
            divtwo.append(label);
            divtwo.append(textarea);
            div.append(divtwo);
            form.append(div);
            $("#form-display").append(form);

            //search button
            var anchor = $("<a>");
            anchor.addClass("btn-large waves-effect waves-light orange");
            anchor.attr("id", "search");
            anchor.text("Search");

            //append button to page
            $("#button-display").append(anchor);

            //second click event=======================================================
            $("#search").on("click", function(event) {
                event.preventDefault();

                //form disappears
                $("#form-display").hide();
                anchor.hide();

                //create new button to start again
                var searchAgain = $("<a>");
                searchAgain.addClass("btn-large waves-effect waves-light orange");
                searchAgain.attr("id", "searchAgain");
                searchAgain.text("Search again");
                
                $("#button-display").append(searchAgain);
                  $("#searchAgain").on("click", function(event){
                    //clear the former recipes
                    $("#card-display").empty();
                    //TO DO this is not ideal as it simply reloads page
                  location.reload();
                    //need to assign to search again same functionality of get started

                    
//TO DO I want to call getStarted(); to load page again but think scope issue
               
                })
=======
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
  <link href="https://fonts.googleapis.com/css?family=Fredericka+the+Great|Alegreya" rel="stylesheet">
  <title>Lazy Chef</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">
  <link rel="stylesheet" type="text/css" href="assets/css/style.css">
  <script src="https://www.gstatic.com/firebasejs/4.8.0/firebase.js"></script>
  </head>
  
<body>
  
  <div class="section no-pad-bot" id="index-banner">
    <div class="container">
     <br><br>
      <h1 class="header center projectname">LazyChef</h1>
      <div class="row center">
        <h5 class="header col s12 light">Your Ingredients. Our Recipes. Made Easy. </h5>
      </div>
 
<div class="row">
    <form class="col s12" >
      <div class="row" >
        <div class="input-field col s12" id = "ingredients">
          <textarea id="textarea1" class="materialize-textarea" ></textarea>
          <label id="label" for="textarea1"></label>
         </div>
      </div>
    </form> 
  </div>


      <div class="row center">
        <a class="btn-large waves-effect waves-light orange" id="getStarted">Get Started</a>
      </div>
    </div>
  </div>

  <div class="row" id="form-display">
  </div>
  
  <div class = "row center" id = "button-display">
  </div>
  
  <div class="row" id="card-display">
  </div> 
  
  <div id="ingredient-table">
  </div>

<script type="text/javascript">

// FIREBASE CONFIG===================================================================
var config = {
    apiKey: "AIzaSyD8Ov99hsKZO0NbPCd1fVBlX3EuWKLX0tI",
    authDomain: "project-one-f8be2.firebaseapp.com",
    databaseURL: "https://project-one-f8be2.firebaseio.com",
    projectId: "project-one-f8be2",
    storageBucket: "",
    messagingSenderId: "426004539514"
  };
firebase.initializeApp(config);  
var database = firebase.database();

// on page load form is hidden
$("#textarea1").hide()

// VARIABLES==========================================================================  
>>>>>>> 01c4852d1af1940e8b48684bab8998b728e96aa9

//Array that we will push ingredients into on click Submit Button 
var ingredients_array = [];

<<<<<<< HEAD
                // Grabs user input Here is the problem: how to grab input textarea not working
                var ingredients = $("#ingredients").val().trim();
                ingredients_array.push(ingredients);
                sendRequest();
                $("#table").show();
                var tableData = $("<td>");
                tableData.text(this.ingredients);
                // local object to put ingredients in
                var newIngredient = {
                    name: ingredients

                };

                // send ingredients to database
                database.ref().push(newIngredient);

                // console.log(newIngredient.name);

                // Clear form
                $("#ingredients").val("");
=======
//Stores recipe ID from first AJAX call
var recipeId=[];

var queryURL;  
>>>>>>> 01c4852d1af1940e8b48684bab8998b728e96aa9

                return false;
            }) //search click event

<<<<<<< HEAD
        }) //getStarted click event
    } //getStarted function end


    // Firebase event for adding ingredients to the database and a row in the html when a user adds an entry
    database.ref().on("child_added", function(childSnapshot, prevChildKey) {

        // console.log(childSnapshot.val());

        var ingredientName = childSnapshot.val().name;

        // console.log(ingredientName);

        // Add each ingredient into the table
        $("#table > tbody").append("<tr><td>" + this.ingredients_array);

    });




    // Functions===============================================================================
    //wrap spoonacular ajax call in a function 
    function sendRequest() {
        $.ajax({
                url: queryURL,
                method: "GET",
                beforeSend: function(xhr) {
                    xhr.setRequestHeader('X-Mashape-Key', '0NlfRZkMP2mshjWL30gtKXh3l6fYp16R7Z4jsnxYY5nUKHDcPA');
                    xhr.setRequestHeader('Accept', 'application/json')
                }
            })
            .done(function(response) {
                //console.log(response);
                for (var i = 0; i < response.length; i++) {

                    recipeId.push(response[i].id);
                    console.log(recipeId);

                    // var box = $("<button>");
                    // box.attr("title",response[i].title);

                    // div .card
                    var card = $("<div>");
                    card.addClass("card col s12 m2 recipecard");
                    card.attr("id", response[i].id);

                    // div .card-image
                    var cardImage = $("<div>");
                    cardImage.addClass("card-image recipecard");

                    // img .images
                    var image = $("<img>");

                    image.attr("src", response[i].image);
                    image.addClass("images");

                    // span .card-title
                    var cardTitle = $("<span>");
                    cardTitle.addClass("card-title");
                    cardTitle.attr("id", "recipetitle");


                    cardTitle.text(response[i].title);
=======

// CLICK EVENTS========================================================================

$("#getStarted").on("click", function(event) {
  
  event.preventDefault();

//hide getStarted button
  $("#getStarted").hide();

//show form
  $("#textarea1").show();

//dynamically create form and search button
  var form = $("<form>");
  form.addClass("col s12");
  
  var div = $("<div>");
  div.addClass("row");

//id ingredients will be used to grab input
  var divtwo = $("<div>");
  divtwo.addClass("input-field col s12");
  divtwo.attr("id", "ingredients");
  
  var textarea = $("textarea");
  textarea.attr("id", "textarea1");
  textarea.addClass("materialize-textarea");
  
  var label = $("<label>");
  label.addClass("active");
  label.attr("for", "textarea1");
  label.attr("id", "label");
  label.text("Enter your ingredients");

//append form to page
  divtwo.append(label);
  divtwo.append(textarea);
  div.append(divtwo);
  form.append(div);
  $("#form-display").append(form);

//search button
  var anchor = $("<a>");
  anchor.addClass("btn-large waves-effect waves-light orange");
  anchor.attr("id", "search");
  anchor.text("Search");

//append button to page
  $("#button-display").append(anchor);
      
  $("#search").on("click", function(event){
      event.preventDefault();
    
 //form disappears
  $("#textarea1").empty();
      
  //var ingredients = $("#ingredients").val().trim();
      var ingredients = $("#textarea1").val().trim();

      console.log(ingredients);
      //ingredients_array.push(ingredients);
      ingredients_array = ingredients.split(" ");
      console.log("Ingredients array = " + ingredients_array);

      var combined_string = ingredients_array.join(',');
      console.log(combined_string);
      queryURL = "https://spoonacular-recipe-food-nutrition-v1.p.mashape.com/recipes/findByIngredients?fillIngredients=false&ingredients=" + combined_string + "limitLicense=false&number=5&ranking=1";
      console.log(queryURL);
      sendRequest();
  
  // local object to put ingredients in
  var newIngredient = {
    name: ingredients
   
  };
  // send ingredients to database
  // database.ref().push(newIngredient);
  // console.log(newIngredient.name);
    
  // Clear form
  $("#textarea1").val("");
  
  //return false;
  })//search click event
})//getStarted click event
// Firebase event for adding ingredients to the database and a row in the html when a user adds an entry
// database.ref().on("child_added", function(childSnapshot, prevChildKey) {
//   console.log(childSnapshot.val());
//   var ingredientName = childSnapshot.val().name;
//   console.log(ingredientName);
//    // Add each ingredient into the table
//   $("#ingredient-table > tbody").append("<tr><td>" + ingredientName + "</td><td>" + "</td></tr>");
// });
  
  
// Functions===============================================================================
//wrap ajax call in a function 
function sendRequest (){
$.ajax({
  url: queryURL, 
  method: "GET", 
  beforeSend: function(xhr){  
    xhr.setRequestHeader('X-Mashape-Key', '0NlfRZkMP2mshjWL30gtKXh3l6fYp16R7Z4jsnxYY5nUKHDcPA');
    xhr.setRequestHeader('Accept', 'application/json')
  }
})
.done(function(response) {
  //console.log(response);
  for (var i=0; i< response.length; i++){
    
    recipeId.push(response[i].id);
    console.log(recipeId);
    

    // div .card
    var card = $("<div>");
    card.addClass("card col s12 m2 waves-effect waves-block waves-light hoverable recipecard");
    card.attr("id", response[i].id);

    // div .card-image
    var cardImage = $("<div>");
    cardImage.addClass("card-image ");
    

    // img .images
    var image = $("<img>");
    image.attr("src", response[i].image);
    image.addClass("images");

    // span .card-title
    var cardTitle = $("<span>");
    cardTitle.addClass("card-title");
    cardTitle.attr("id", "recipetitle");
    cardTitle.text(response[i].title);
    cardTitle.append("<br><br>");
    cardTitle.append("Missed: " + response[i].missedIngredientCount);
    cardTitle.append("Used: " + response[i].usedIngredientCount);
    
    

    cardImage.append(image);
    card.append(cardTitle);
    card.append(cardImage);
    

    $("#card-display").append(card);
    for (var key in response[i]){console.log(key + '->' + response[i][key]);}
  }
})
>>>>>>> 01c4852d1af1940e8b48684bab8998b728e96aa9

                    cardImage.append(image);
                    cardImage.append(cardTitle);
                    card.append(cardImage);

                    $("#card-display").append(card);

                }
            })

        $(document).on('click', '.card', function() {
            var itemID = $(this).attr("id");
            console.log("user clicked on item " + itemID);

<<<<<<< HEAD
            var queryURL = "https://spoonacular-recipe-food-nutrition-v1.p.mashape.com/recipes/" + itemID + "/information?includeNutrition=false";

            console.log(queryURL);

            $.ajax({
                    url: queryURL,
                    method: "GET",
                    beforeSend: function(xhr) {
                        xhr.setRequestHeader('X-Mashape-Key', '0NlfRZkMP2mshjWL30gtKXh3l6fYp16R7Z4jsnxYY5nUKHDcPA');
                        xhr.setRequestHeader('Accept', 'application/json')
                    }
                })
                .done(function(response) {
                    console.log(response.sourceUrl);
                    window.open(response.sourceUrl);
                })

        });
    } //end function sendRequest

    //TO DO add new function to call Google API
    </script>
</body>

</html>
=======
}//end function sendRequest
     
    
</script>
</body>
</html>
>>>>>>> 01c4852d1af1940e8b48684bab8998b728e96aa9
